const fs = require('fs');
const path = require('path');

// Sample user data (replace this with dynamic data as needed)
const userData = {
    name: "John Doe",
    emergencyContact: "Jane Doe",
    age: 30,
    gender: "Male",
    dob: "1994-01-01",
    bloodGroup: "O+",
    insuranceId: "123456789",
    pcpName: "Dr. Smith",
    pcpNumber: "9876543210",
    maritalStatus: "Single",
    medicalProxyNumber: "111222333",
    insuranceInfo: {
        policyName: "HealthPlan",
        employer: "Company Inc.",
        employerAddress: "123 Main St.",
        policyId: "POL123456"
    },
    medicalHistory: {
        chronicConditions: "None",
        chronicMedications: "None",
        surgicalHistory: "None",
        congenitalDiseaseHistory: "None",
        familyHistory: "None",
        socialHistory: "Non-smoker",
        vaccineHistory: "Up-to-date"
    },
    allergenInformation: {
        foodAllergies: "Peanuts",
        materialAllergies: "None",
        medicationAllergies: "Penicillin"
    },
    doctorNote: "No special instructions."
};

// Generate HTML content
const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Information</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }
        .container { width: 80%; margin: auto; padding: 2rem; }
        h1 { color: #075cdd; }
        .section { background: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); margin-bottom: 2rem; padding: 2rem; }
        .section h2 { margin-top: 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Patient Information</h1>
        <div class="section">
            <h2>Personal Details</h2>
            <p><strong>Name:</strong> ${userData.name}</p>
            <p><strong>Emergency Contact:</strong> ${userData.emergencyContact}</p>
            <p><strong>Age:</strong> ${userData.age}</p>
            <p><strong>Gender:</strong> ${userData.gender}</p>
            <p><strong>Date of Birth:</strong> ${userData.dob}</p>
            <p><strong>Blood Group:</strong> ${userData.bloodGroup}</p>
            <p><strong>Insurance ID:</strong> ${userData.insuranceId}</p>
            <p><strong>Primary Care Physician Name:</strong> ${userData.pcpName}</p>
            <p><strong>Primary Care Physician Number:</strong> ${userData.pcpNumber}</p>
            <p><strong>Marital Status:</strong> ${userData.maritalStatus}</p>
            <p><strong>Medical Proxy Number:</strong> ${userData.medicalProxyNumber}</p>
        </div>
        <div class="section">
            <h2>Insurance Info</h2>
            <p><strong>Name of Policy:</strong> ${userData.insuranceInfo.policyName}</p>
            <p><strong>Employer:</strong> ${userData.insuranceInfo.employer}</p>
            <p><strong>Employer Address:</strong> ${userData.insuranceInfo.employerAddress}</p>
            <p><strong>Policy ID:</strong> ${userData.insuranceInfo.policyId}</p>
        </div>
        <div class="section">
            <h2>Medical History</h2>
            <p><strong>Chronic Conditions:</strong> ${userData.medicalHistory.chronicConditions}</p>
            <p><strong>Chronic Medications:</strong> ${userData.medicalHistory.chronicMedications}</p>
            <p><strong>Surgical History:</strong> ${userData.medicalHistory.surgicalHistory}</p>
            <p><strong>Congenital Disease History:</strong> ${userData.medicalHistory.congenitalDiseaseHistory}</p>
            <p><strong>Family History:</strong> ${userData.medicalHistory.familyHistory}</p>
            <p><strong>Social History:</strong> ${userData.medicalHistory.socialHistory}</p>
            <p><strong>Vaccine History:</strong> ${userData.medicalHistory.vaccineHistory}</p>
        </div>
        <div class="section">
            <h2>Allergen Information</h2>
            <p><strong>Food Allergies:</strong> ${userData.allergenInformation.foodAllergies}</p>
            <p><strong>Material Allergies:</strong> ${userData.allergenInformation.materialAllergies}</p>
            <p><strong>Medication Allergies:</strong> ${userData.allergenInformation.medicationAllergies}</p>
        </div>
        <div class="section">
            <h2>Note to Doctor</h2>
            <p>${userData.doctorNote}</p>
        </div>
    </div>
</body>
</html>
`;

// Generate Data URL
const dataUrl = `data:text/html;charset=utf-8,${encodeURIComponent(htmlContent)}`;

// Write data URL to sample.html
const sampleHtmlPath = path.join(__dirname, 'sample.html');
let sampleHtmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Information</title>
    <script>
        function openDataUrl() {
            window.open("${dataUrl}", "_blank");
        }
    </script>
</head>
<body>
    <button onclick="openDataUrl()">Open Patient Information</button>
</body>
</html>
`;

fs.writeFileSync(sampleHtmlPath, sampleHtmlContent);
console.log('sample.html updated with the data URL.');
